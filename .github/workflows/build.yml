name: Build HuskSync

# 触发条件：当推送到 master 分支或发起 Pull Request 时触发
on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  # 允许手动在 Actions 页面触发
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. 检出仓库代码
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. 设置 Java 环境 (JDK 21)
    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'gradle' # 开启 Gradle 缓存以加快构建速度

    # 3. 赋予 gradlew 执行权限 (防止权限不足的错误)
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    # 4. 执行 Gradle 构建
    - name: Build with Gradle
      run: ./gradlew clean build

    # 5. 上传构建好的 Jar 包作为 Artifact
    # Gradle 默认输出目录通常是 build/libs
    - name: Upload Build Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: HuskSync-Jars
        path: build/libs/*.jar
        # 如果项目配置了输出到 target 目录（README 中曾有提及），可以使用以下路径：
        # path: |
        #   build/libs/*.jar
        #   target/*.jar
